(function(){function e(e,t,n){e.addEventListener?e.addEventListener(t,n,!1):e.attachEvent("on"+t,n)}function t(e){if("keypress"==e.type){var t=String.fromCharCode(e.which);return e.shiftKey||(t=t.toLowerCase())," "==t?"space":t}return c[e.which]?c[e.which]:h[e.which]?h[e.which]:String.fromCharCode(e.which).toLowerCase()}function n(e){e=e||{};var t=!1,n;for(n in y)e[n]?t=!0:y[n]=0;t||(S=!1)}function r(e,t,n,r,i,s){var o,a,f=[],l=n.type;if(!m[e])return[];"keyup"==l&&u(e)&&(t=[e]);for(o=0;o<m[e].length;++o)if(a=m[e][o],!(!r&&a.seq&&y[a.seq]!=a.level||l!=a.action||("keypress"!=l||n.metaKey||n.ctrlKey)&&t.sort().join(",")!==a.modifiers.sort().join(","))){var c=r&&a.seq==r&&a.level==s;(!r&&a.combo==i||c)&&m[e].splice(o,1),f.push(a)}return f}function i(e){var t=[];return e.shiftKey&&t.push("shift"),e.altKey&&t.push("alt"),e.ctrlKey&&t.push("ctrl"),e.metaKey&&t.push("meta"),t}function s(e,t,n){T.stopCallback(t,t.target||t.srcElement,n)||!1!==e(t,n)||(t.preventDefault&&t.preventDefault(),t.stopPropagation&&t.stopPropagation(),t.returnValue=!1,t.cancelBubble=!0)}function o(e){"number"!=typeof e.which&&(e.which=e.keyCode);var n=t(e);n&&("keyup"==e.type&&w===n?w=!1:T.handleKey(n,i(e),e))}function u(e){return"shift"==e||"ctrl"==e||"alt"==e||"meta"==e}function a(e,r,i,o){function u(t){return function(){S=t,++y[e],clearTimeout(b),b=setTimeout(n,1e3)}}function a(r){s(i,r,e),"keyup"!==o&&(w=t(r)),setTimeout(n,10)}for(var c=y[e]=0;c<r.length;++c){var h=c+1===r.length?a:u(o||f(r[c+1]).action);l(r[c],h,o,e,c)}}function f(e,t){var n,r,i,s=[];n="+"===e?["+"]:e.split("+");for(i=0;i<n.length;++i)r=n[i],d[r]&&(r=d[r]),t&&"keypress"!=t&&p[r]&&(r=p[r],s.push("shift")),u(r)&&s.push(r);n=r,i=t;if(!i){if(!v){v={};for(var o in c)95<o&&112>o||c.hasOwnProperty(o)&&(v[c[o]]=o)}i=v[n]?"keydown":"keypress"}return"keypress"==i&&s.length&&(i="keydown"),{key:r,modifiers:s,action:i}}function l(e,t,n,i,s){g[e+":"+n]=t,e=e.replace(/\s+/g," ");var o=e.split(" ");1<o.length?a(e,o,t,n):(n=f(e,n),m[n.key]=m[n.key]||[],r(n.key,n.modifiers,{type:n.action},i,e,s),m[n.key][i?"unshift":"push"]({callback:t,modifiers:n.modifiers,action:n.action,seq:i,level:s,combo:e}))}for(var c={8:"backspace",9:"tab",13:"enter",16:"shift",17:"ctrl",18:"alt",20:"capslock",27:"esc",32:"space",33:"pageup",34:"pagedown",35:"end",36:"home",37:"left",38:"up",39:"right",40:"down",45:"ins",46:"del",91:"meta",93:"meta",224:"meta"},h={106:"*",107:"+",109:"-",110:".",111:"/",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'"},p={"~":"`","!":"1","@":"2","#":"3",$:"4","%":"5","^":"6","&":"7","*":"8","(":"9",")":"0",_:"-","+":"=",":":";",'"':"'","<":",",">":".","?":"/","|":"\\"},d={option:"alt",command:"meta","return":"enter",escape:"esc",mod:/Mac|iPod|iPhone|iPad/.test(navigator.platform)?"meta":"ctrl"},v,m={},g={},y={},b,w=!1,E=!1,S=!1,x=1;20>x;++x)c[111+x]="f"+x;for(x=0;9>=x;++x)c[x+96]=x;e(document,"keypress",o),e(document,"keydown",o),e(document,"keyup",o);var T={bind:function(e,t,n){e=e instanceof Array?e:[e];for(var r=0;r<e.length;++r)l(e[r],t,n);return this},unbind:function(e,t){return T.bind(e,function(){},t)},trigger:function(e,t){return g[e+":"+t]&&g[e+":"+t]({},e),this},reset:function(){return m={},g={},this},stopCallback:function(e,t){return-1<(" "+t.className+" ").indexOf(" mousetrap ")?!1:"INPUT"==t.tagName||"SELECT"==t.tagName||"TEXTAREA"==t.tagName||t.contentEditable&&"true"==t.contentEditable},handleKey:function(e,t,i){var o=r(e,t,i),a;t={};var f=0,l=!1;for(a=0;a<o.length;++a)o[a].seq&&(f=Math.max(f,o[a].level));for(a=0;a<o.length;++a)o[a].seq?o[a].level==f&&(l=!0,t[o[a].seq]=1,s(o[a].callback,i,o[a].combo)):l||s(o[a].callback,i,o[a].combo);o="keypress"==i.type&&E,i.type!=S||u(e)||o||n(t),E=l&&"keydown"==i.type}};window.Mousetrap=T,"function"==typeof define&&define.amd&&define(T)})();